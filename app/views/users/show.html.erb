<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>

<script>

//$.ajaxSetup({
//  headers: {
//    'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
// }
//});

$(document).ready(function(){
    $('#metricdate').change(function() {
        metricdate.val($(this).val());
        //var datevalue = $(this).val()
        //$.get( '/fbmetrics', {id:"1", metricdate:datevalue} );
        //window.location.reload();
      });
});

//$(document).on('page:update', ready);

</script>

<% provide(:title, @user.name) %>
<div class="row">
  <aside class="span4">
    <section>
      <h1>
        <%= gravatar_for @user %>
        <%= @user.name %>
      </h1>
    </section>
    <section>
      <%= render 'shared/grades' %>
    </section>
  </aside>
    <div class="span8">
  <%=form_tag(fbmetrics_path(:id => @user.id), method: :get) do%>
    <%= csrf_meta_tag %>
    <%= hidden_field_tag :id, @user.id %>
    <%if @user.metrics.any? %>
      <h3>Daily Metrics For: <%=@dateToShow%>
      <%=date_field_tag 'metricdate', @dateToShow, :onchange => "this.form.submit();"%> 

      <!--(<%#= @metricsToShow.count %> of <%#=@metricconfigs.count %>)--></h3>
     <%#= date_field(:metricdate, :value) %>    
      <ol class="metricConfigs">
      <table>
        <% @metricsToShow.each do |metric|%>
        <% mv = metric.value %>
          <% if @metricconfigs.find(metric.metric_config_id).profiledisplay == true %>
          <tr>
            <td>
            <%= @metricconfigs.find(metric.metric_config_id).metricname%>
            </td>
            <% if @metricconfigs.find(metric.metric_config_id).metrictype == "minutes" %>
            <td>
            <%= (mv/60).round(2) %>
            <%# elsif @metricconfigs.find(metric.metric_config_id).metrictype == "boolean" %>
            <!--<td>-->
              <%#= check_box_tag metric.id, mv, mv %>
            <% else %>
            <td>
              <%= mv %>
            <% end %>
            <%= @metricconfigs.find(metric.metric_config_id).label%>
            </td>
            <td>
              <% if @metricconfigs.find(metric.metric_config_id).updateable == true %>
                <%= link_to 'Show', metric %>
                <%= link_to 'Edit', edit_metric_path(metric) %>
                <%= link_to 'Destroy', metric, method: :delete, data: { confirm: 'Are you sure?' } %>
            </td>
              <% end %>
            <% end %>
        <% end %>  
          </tr>        
        </table>
      </ol>
      <BR>
    <% end %>
    <!-- This is the end for the form_tag-->
    <% end %>
    <%#= link_to 'New Metric', new_metric_path, class: "btn btn-large btn-primary" %>
    <%= link_to "Update FitBit Metrics", fbmetrics_path(:updateMetrics => 'Y', :id => @user.id, :metricdate => @dateToShow), class: "btn btn-large btn-primary" %> 
  </div>
</div>